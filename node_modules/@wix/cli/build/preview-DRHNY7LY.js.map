{"version":3,"sources":["../../cli-site-old/src/preview/index.ts","../../cli-site-old/src/preview/preview.ts"],"sourcesContent":["export { preview } from './preview.js';\n","import { exit } from 'node:process';\nimport { DeploymentOperation } from '@wix/ambassador-velo-apps-v1-app/types';\nimport prompts from 'prompts';\nimport { writeCrashReport } from '@wix/cli-debug-log';\nimport { getDebugLogFilePath } from '@wix/cli-core-definitions';\nimport type { CommandServices } from '@wix/cli-command-contract';\nimport { getDefaultBranch } from '../git/index.js';\nimport { deployGridApp, DeploymentSource } from '../gridapp/deployApp.js';\nimport { createI18nT } from '../i18n.js';\nimport { createLogger } from '../logger.js';\nimport type { ProjectModel } from '../model.js';\nimport { isSiteNotPublishedError } from '../utils.js';\nimport { authenticate } from '../authentication.js';\n\nexport async function preview(\n  model: ProjectModel,\n  { biLogger, errorReporter }: CommandServices,\n  options: {\n    source?: 'local' | 'remote';\n  }\n) {\n  const authState = await authenticate({\n    metaSiteId: model.metaSiteId,\n    biLogger,\n    errorReporter,\n  });\n\n  const t = createI18nT();\n  const logger = createLogger({ t });\n\n  const defaultBranchName = await getDefaultBranch((e) =>\n    writeCrashReport(getDebugLogFilePath(model.projectFolder), e)\n  );\n\n  const whatToPreview = options.source\n    ? { value: options.source }\n    : await prompts(\n        {\n          type: 'select',\n          name: 'value',\n          message: logger.t('preview_command.prompt_what_to_preview'),\n          choices: [\n            {\n              title: defaultBranchName\n                ? logger.t(\n                    'preview_command.prompt_what_to_preview_choice_latest',\n                    {\n                      branchName: defaultBranchName,\n                    }\n                  )\n                : logger.t(\n                    'preview_command.prompt_what_to_preview_choice_latest_fallback'\n                  ),\n              value: 'remote',\n            },\n            {\n              title: logger.t(\n                'preview_command.prompt_what_to_preview_choice_local'\n              ),\n              value: 'local',\n            },\n          ],\n        },\n        {\n          onCancel: () => {\n            logger.logAborting();\n            exit(130 /* SIGINT */);\n          },\n        }\n      );\n\n  const deploymentSource =\n    whatToPreview.value === 'local'\n      ? DeploymentSource.local()\n      : DeploymentSource.remote({});\n\n  logger.logCreatingPreview();\n\n  try {\n    const preview = await deployGridApp({\n      model,\n      operation: DeploymentOperation.RC,\n      source: deploymentSource,\n      authState,\n    });\n\n    logger.logPreviewCreated(\n      preview.deploymentShortUrl ?? preview.deploymentUrl\n    );\n  } catch (err) {\n    if (isSiteNotPublishedError(err)) {\n      logger.logPreviewUnsupported();\n    } else {\n      throw err;\n    }\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;ACAA;AAAA,SAAS,YAAY;AAErB,qBAAoB;AAYpB,eAAsB,QACpB,OACA,EAAE,UAAU,cAAc,GAC1B,SAGA;AACA,QAAM,YAAY,MAAM,aAAa;AAAA,IACnC,YAAY,MAAM;AAAA,IAClB;AAAA,IACA;AAAA,EACF,CAAC;AAED,QAAM,IAAI,YAAY;AACtB,QAAM,SAAS,aAAa,EAAE,EAAE,CAAC;AAEjC,QAAM,oBAAoB,MAAM;AAAA,IAAiB,CAAC,MAChD,iBAAiB,oBAAoB,MAAM,aAAa,GAAG,CAAC;AAAA,EAC9D;AAEA,QAAM,gBAAgB,QAAQ,SAC1B,EAAE,OAAO,QAAQ,OAAO,IACxB,UAAM,eAAAA;AAAA,IACJ;AAAA,MACE,MAAM;AAAA,MACN,MAAM;AAAA,MACN,SAAS,OAAO,EAAE,wCAAwC;AAAA,MAC1D,SAAS;AAAA,QACP;AAAA,UACE,OAAO,oBACH,OAAO;AAAA,YACL;AAAA,YACA;AAAA,cACE,YAAY;AAAA,YACd;AAAA,UACF,IACA,OAAO;AAAA,YACL;AAAA,UACF;AAAA,UACJ,OAAO;AAAA,QACT;AAAA,QACA;AAAA,UACE,OAAO,OAAO;AAAA,YACZ;AAAA,UACF;AAAA,UACA,OAAO;AAAA,QACT;AAAA,MACF;AAAA,IACF;AAAA,IACA;AAAA,MACE,UAAU,MAAM;AACd,eAAO,YAAY;AACnB;AAAA,UAAK;AAAA;AAAA,QAAgB;AAAA,MACvB;AAAA,IACF;AAAA,EACF;AAEJ,QAAM,mBACJ,cAAc,UAAU,UACpB,iBAAiB,MAAM,IACvB,iBAAiB,OAAO,CAAC,CAAC;AAEhC,SAAO,mBAAmB;AAE1B,MAAI;AACF,UAAMC,WAAU,MAAM,cAAc;AAAA,MAClC;AAAA,MACA,WAAW,oBAAoB;AAAA,MAC/B,QAAQ;AAAA,MACR;AAAA,IACF,CAAC;AAED,WAAO;AAAA,MACLA,SAAQ,sBAAsBA,SAAQ;AAAA,IACxC;AAAA,EACF,SAAS,KAAK;AACZ,QAAI,wBAAwB,GAAG,GAAG;AAChC,aAAO,sBAAsB;AAAA,IAC/B,OAAO;AACL,YAAM;AAAA,IACR;AAAA,EACF;AACF;","names":["prompts","preview"]}