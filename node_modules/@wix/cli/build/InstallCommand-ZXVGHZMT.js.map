{"version":3,"sources":["../../cli-site/src/components/InstallCommand/InstallCommand.tsx","../../cli-site/src/services/dependencies.ts"],"sourcesContent":["import React from 'react';\nimport type { FC } from 'react';\nimport { match } from 'variant';\nimport { Trans } from '@wix/cli-i18n';\nimport { useVeloClient } from '@wix/velo-client';\nimport { useAsync, Spinner, Alert, Badge, Text } from '@wix/cli-ui-kit';\nimport { createDependenciesService } from '../../services/dependencies.js';\nimport { useProjectModel } from '../../model.js';\n\ninterface Props {\n  packageName?: string;\n}\n\nexport const InstallCommand: FC<Props> = ({ packageName }) => {\n  const { model } = useProjectModel();\n  const veloClient = useVeloClient();\n\n  const { status } = useAsync(async () => {\n    const { projectFolder } = model;\n    const service = await createDependenciesService(projectFolder, veloClient);\n\n    await service.install(packageName);\n  }, []);\n\n  return match(status, {\n    Loading: () => (\n      <Spinner\n        text={\n          packageName ? (\n            <Trans\n              i18nKey=\"install_command.package.loading\"\n              values={{ packageName }}\n              components={[<Text bold />]}\n            />\n          ) : (\n            <Trans i18nKey=\"install_command.all_packages.loading\" />\n          )\n        }\n      />\n    ),\n    Error: () => null,\n    Success: () => (\n      <Alert type=\"success\">\n        <Badge skin=\"success\">\n          <Trans i18nKey=\"general.success\" />\n        </Badge>{' '}\n        {packageName ? (\n          <Trans\n            i18nKey=\"install_command.package.success\"\n            values={{ packageName }}\n            components={[<Text bold />]}\n          />\n        ) : (\n          <Trans i18nKey=\"install_command.all_packages.success\" />\n        )}\n      </Alert>\n    ),\n  });\n};\n","import type { VeloClient } from '@wix/velo-client';\nimport { getRepoType, createPackageManager } from '@wix/package-manager';\nimport { getProjectDependencies } from '../velo.js';\nimport { saveWixLock } from '../files/wix.lock.js';\n\nexport async function createDependenciesService(\n  projectFolder: string,\n  veloClient: VeloClient\n) {\n  return {\n    install: async (packageName?: string) => {\n      const repoType = await getRepoType(projectFolder);\n      const packageManager = await createPackageManager(repoType);\n\n      if (packageName) {\n        await packageManager.runInstallPackage(projectFolder, packageName);\n      } else {\n        await packageManager.runInstall(projectFolder);\n      }\n\n      const dependencies = await getProjectDependencies(projectFolder);\n      const wixLockContent = await veloClient.generateWixLockFile(dependencies);\n\n      await saveWixLock(projectFolder, wixLockContent);\n    },\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA,mBAAkB;AAElB,qBAAsB;;;ACFtB;AAKA,eAAsB,0BACpB,eACA,YACA;AACA,SAAO;AAAA,IACL,SAAS,OAAO,gBAAyB;AACvC,YAAM,WAAW,MAAM,YAAY,aAAa;AAChD,YAAM,iBAAiB,MAAM,qBAAqB,QAAQ;AAE1D,UAAI,aAAa;AACf,cAAM,eAAe,kBAAkB,eAAe,WAAW;AAAA,MACnE,OAAO;AACL,cAAM,eAAe,WAAW,aAAa;AAAA,MAC/C;AAEA,YAAM,eAAe,MAAM,uBAAuB,aAAa;AAC/D,YAAM,iBAAiB,MAAM,WAAW,oBAAoB,YAAY;AAExE,YAAM,YAAY,eAAe,cAAc;AAAA,IACjD;AAAA,EACF;AACF;;;ADbO,IAAM,iBAA4B,CAAC,EAAE,YAAY,MAAM;AAC5D,QAAM,EAAE,MAAM,IAAI,gBAAgB;AAClC,QAAM,aAAa,cAAc;AAEjC,QAAM,EAAE,OAAO,IAAI,SAAS,YAAY;AACtC,UAAM,EAAE,cAAc,IAAI;AAC1B,UAAM,UAAU,MAAM,0BAA0B,eAAe,UAAU;AAEzE,UAAM,QAAQ,QAAQ,WAAW;AAAA,EACnC,GAAG,CAAC,CAAC;AAEL,aAAO,sBAAM,QAAQ;AAAA,IACnB,SAAS,MACP,6BAAAA,QAAA;AAAA,MAAC;AAAA;AAAA,QACC,MACE,cACE,6BAAAA,QAAA;AAAA,UAAC;AAAA;AAAA,YACC,SAAQ;AAAA,YACR,QAAQ,EAAE,YAAY;AAAA,YACtB,YAAY,CAAC,6BAAAA,QAAA,cAAC,QAAK,MAAI,MAAC,CAAE;AAAA;AAAA,QAC5B,IAEA,6BAAAA,QAAA,cAAC,SAAM,SAAQ,wCAAuC;AAAA;AAAA,IAG5D;AAAA,IAEF,OAAO,MAAM;AAAA,IACb,SAAS,MACP,6BAAAA,QAAA,cAAC,SAAM,MAAK,aACV,6BAAAA,QAAA,cAAC,SAAM,MAAK,aACV,6BAAAA,QAAA,cAAC,SAAM,SAAQ,mBAAkB,CACnC,GAAS,KACR,cACC,6BAAAA,QAAA;AAAA,MAAC;AAAA;AAAA,QACC,SAAQ;AAAA,QACR,QAAQ,EAAE,YAAY;AAAA,QACtB,YAAY,CAAC,6BAAAA,QAAA,cAAC,QAAK,MAAI,MAAC,CAAE;AAAA;AAAA,IAC5B,IAEA,6BAAAA,QAAA,cAAC,SAAM,SAAQ,wCAAuC,CAE1D;AAAA,EAEJ,CAAC;AACH;","names":["React"]}